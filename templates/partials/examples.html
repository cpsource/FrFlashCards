<!-- templates/partials/examples.html -->
<div class="container my-5">
  <h3 class="text-center mb-4">Exemples de vocabulaire</h3>

  {% if current_user.is_authenticated %}
    <div class="input-group mb-3">
      <input type="text" id="expressionInput" class="form-control" placeholder="Entrez une expression (ex : le manteau)">
      <div class="input-group-append">
        <button class="btn btn-primary" type="button" onclick="display_table_entry()">Afficher</button>
      </div>
    </div>

    <div id="results-area">
      <div id="examples-message" class="text-muted mb-2"></div>

      <table class="table table-striped table-sm" id="examples-table" style="display:none;">
        <thead class="thead-light">
          <tr>
            <th>Français</th>
            <th>Anglais</th>
          </tr>
        </thead>
        <tbody id="examples-tbody"></tbody>
      </table>
    </div>
  {% else %}
    <hr>
    <div class="alert alert-warning text-center">
      <p class="mb-0">You must <a href="{{ url_for('login') }}" class="alert-link">login</a> to get sample sentences.</p>
    </div>
  {% endif %}
</div>

<script>
async function display_table_entry() {
  const expression = document.getElementById("expressionInput").value.trim();
  const msgEl = document.getElementById("examples-message");
  const table = document.getElementById("examples-table");
  const tbody = document.getElementById("examples-tbody");

  msgEl.textContent = "";
  tbody.innerHTML = "";
  table.style.display = "none";

  if (!expression) {
    msgEl.textContent = "Veuillez entrer une expression.";
    return;
  }

  msgEl.textContent = "Chargement des exemples pour « " + expression + " »…";

  try {
    const resp = await fetch("/examples?expression=" + encodeURIComponent(expression));
    if (!resp.ok) {
      msgEl.textContent = "Erreur serveur : " + resp.status + " " + resp.statusText;
      return;
    }

    const data = await resp.json();
    if (data.error) {
      msgEl.textContent = "Erreur : " + data.error;
      return;
    }

    if (!data.examples || data.examples.length === 0) {
      msgEl.textContent = "Aucun exemple trouvé pour « " + expression + " ».";
      return;
    }

    data.examples.forEach(row => {
      const tr = document.createElement("tr");
      const tdFr = document.createElement("td");
      tdFr.textContent = row.french;
      const tdEn = document.createElement("td");
      tdEn.textContent = row.english;
      tr.appendChild(tdFr);
      tr.appendChild(tdEn);
      tbody.appendChild(tr);
    });

    msgEl.textContent = "";
    table.style.display = "";
  } catch (e) {
    console.error(e);
    msgEl.textContent = "Erreur de connexion au serveur.";
  }
}
</script>
